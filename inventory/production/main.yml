# Inventory file for the production environment
#
# References:
#   - How to build your inventory — Ansible Documentation
#     https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html
#
# Copyright 2024 林博仁(Buo-ren Lin) <buo.ren.lin@gmail.com>
# SPDX-License-Identifier: AGPL-3.0-or-later
all:
  hosts:
    brlin-rpi5:
      ansible_host: brlin-rpi5.local

      dhis_host_id: 31753
      dhis_hostname: brlin-taichung.dhis.org
      dhis_authp1: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        34366365323636613735336230646462663338623034373235303362383332366237633534626663
        6439386537353963656636643262326565396662383731300a323062336131656533346661363562
        61353338663063373366343361333165636263633637316535303438633638636664393837656661
        3437626136623534380a663936633034653834303662616636333339326230333931633966326131
        35383864316464363732323366303964333431376462303263616432323566633431303732376266
        64666236343732663962646338303135333164313136633132303465666235313835333631653830
        373066616536343866393263663037666665
      dhis_authp2: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        31383133666466353430613361336164613933326436653532313436343461356635376539373033
        3637336432306463323535393330613066356266326235370a333433643337313037386133623131
        65386237376562653831363265343366653364633065343361643564303534646565356631336530
        3339366634373534370a316639383066393964326330636332633930323438396631653062333137
        31646639393763313866313334313764646465653532623931366637326266326630656465323964
        36353336613364313262383335366361366336663961396630643937353635643132646561376137
        616364666533626437636236336136373139
      dhis_authq1: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        33373662353136366562663563363362326561373065363733303736396561323333313463373561
        6335376332343435656461353861333332353731363635350a303236383730373230653566633061
        65343662363735346634313037346638323165323764663735333033653462303762303266323135
        3666623930666133330a663438643133663333643163303637663461306465313134616364373031
        64306135623636663663316562636630316234623432363137393436326435343865636434333230
        63393437633337383638373634363132393637616537353534653862646362333565626234396661
        336361366462316561653866373630313938
      dhis_authq2: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        61313135396362303438653365386330333835346364383366373536383766643965396461336439
        3434333431613665303935666539666131326136343432310a616239396535623366393436393630
        38363834396135666566643432363633663838633831633438653730626164626261636666376163
        3163386635386639370a303534376265643264333965323731333133353038636332373933316439
        66643334666663336232323165313937363563353633646539323233323132326530376435326433
        61373666613434313164373064666331323037643039343465656635386538613837613263616436
        663765313465336361663763363839393864
      dhis_refresh_interval_secs: 170

      wireguard_port: 51820
      wireguard_private_key: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        37363130343630393363393032356661616138393139353539646662363462646534663036306466
        3963323464326238653332633335396231323436373364660a366561656437316239336563636539
        36626233306366383837626238393761633332336133356564386330316166393166313232373736
        3830396338626666630a636439656135373333623663623338303061633239366666633763636536
        32346466353465356562643464373633323165636537366362393238636162666266643539343338
        6665333737306334393832613330663837663930313365656466

      wireguard_install_kernel_module: false
      wireguard_addresses:
        - 192.168.193.254/24
      wireguard_mtu: "1300"
      wireguard_persistent_keepalive: "25"
      wireguard_preup:
        - echo 1 > /proc/sys/net/ipv4/ip_forward
        - iptables -t filter -A INPUT -p udp --destination-port 51820 -j ACCEPT
      wireguard_postup:
        - iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
        - iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
        - iptables -t filter -A FORWARD -i %i -j ACCEPT
        - iptables -t filter -A FORWARD -o %i -j ACCEPT
      wireguard_predown:
        - iptables -t filter -D FORWARD -o %i -j ACCEPT
        - iptables -t filter -D FORWARD -i %i -j ACCEPT
        - iptables -t nat -D POSTROUTING -o wlan0 -j MASQUERADE
        - iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
      wireguard_postdown:
        - iptables -t filter -D INPUT -p udp --destination-port 51820 -j ACCEPT
        - echo 0 > /proc/sys/net/ipv4/ip_forward

      wireguard_unmanaged_peers:
        # 林博仁（Framework Laptop 13）
        brlin-fw13:
          public_key: iyP+dLa7DQoFd+2DEZpCVILfEmwnc77OZS36Reek1EQ=
          allowed_ips: 192.168.193.1/32
          persistent_keepalive: 25

        # 林博仁（Google Pixel 8 Pro手機）
        brlin-pixel8pro:
          public_key: 1nBVtSNkUWWGuGAEApTYPqbPu8RufK9oq/aFqJZTJx8=
          allowed_ips: 192.168.193.2/32
          persistent_keepalive: 25

        # 林博仁（小米平板 5）
        brlin-mipad5:
          public_key: AiDN1HYi7thmjeqRIW26Jgs1iHbOHIMDidbfSpfJpUc=
          allowed_ips: 192.168.193.3/32

        # 林博仁（Chromecast TV(2K)）
        brlin-chromecast-tv2k:
          public_key: 7VKu4TkMa/kacJZUCZrOv+g5rvRe08mAKOq8JehwZW8=
          allowed_ips: 192.168.193.4/32
